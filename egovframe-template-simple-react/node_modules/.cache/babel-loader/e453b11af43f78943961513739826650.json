{"ast":null,"code":"import { SERVER_URL } from './config';\nimport URL from 'context/url';\nimport CODE from 'context/code';\nexport function requestFetch(url, requestOptions, handler, errorHandler) {\n  console.groupCollapsed(\"requestFetch\");\n  console.log(\"requestFetch [URL] : \", SERVER_URL + url);\n  console.log(\"requestFetch [requestOption] : \", requestOptions); //CORS ISSUE 로 인한 조치 - origin 및 credentials 추가 \n  // origin 추가\n\n  if (!requestOptions['origin']) {\n    requestOptions = { ...requestOptions,\n      origin: SERVER_URL\n    };\n  } // credentials 추가 \n\n\n  if (!requestOptions['credentials']) {\n    requestOptions = { ...requestOptions,\n      credentials: 'include'\n    };\n  }\n\n  fetch(SERVER_URL + url, requestOptions).then(response => {\n    // response Stream. Not completion object\n    //console.log(\"requestFetch [Response Stream] \", response); \n    return response.json();\n  }).then(resp => {\n    if (Number(resp.resultCode) === Number(CODE.RCV_ERROR_AUTH)) {\n      alert(\"Login Alert\");\n      window.location.href = URL.LOGIN;\n      return false;\n    } else {\n      return resp;\n    }\n  }).then(resp => {\n    console.groupCollapsed(\"requestFetch.then()\");\n    console.log(\"requestFetch [response] \", resp);\n\n    if (typeof handler === 'function') {\n      handler(resp);\n    } else {\n      console.log('egov fetch handler not assigned!');\n    }\n\n    console.groupEnd(\"requestFetch.then()\");\n  }).catch(error => {\n    console.error('There was an error!', error);\n\n    if (error === 'TypeError: Failed to fetch') {\n      alert(\"서버와의 연결이 원활하지 않습니다. 서버를 확인하세요.\");\n    }\n\n    if (typeof errorHandler === 'function') {\n      errorHandler(error);\n    } else {\n      console.error('egov error handler not assigned!');\n      alert(\"ERR : \" + error.message);\n    }\n  }).finally(() => {\n    console.log(\"requestFetch finally end\");\n    console.groupEnd(\"requestFetch\");\n  });\n}","map":{"version":3,"names":["SERVER_URL","URL","CODE","requestFetch","url","requestOptions","handler","errorHandler","console","groupCollapsed","log","origin","credentials","fetch","then","response","json","resp","Number","resultCode","RCV_ERROR_AUTH","alert","window","location","href","LOGIN","groupEnd","catch","error","message","finally"],"sources":["C:/Dev/eGovFrameDev-4.0.0-64bit/workspace/ecEgovBoot/egovframe-template-simple-react/src/context/egovFetch.js"],"sourcesContent":["import { SERVER_URL } from './config';\r\n\r\nimport URL from 'context/url';\r\nimport CODE from 'context/code';\r\n\r\nexport function requestFetch(url, requestOptions, handler, errorHandler) {\r\n    console.groupCollapsed(\"requestFetch\");\r\n    console.log(\"requestFetch [URL] : \", SERVER_URL + url);\r\n    console.log(\"requestFetch [requestOption] : \", requestOptions);\r\n\r\n    //CORS ISSUE 로 인한 조치 - origin 및 credentials 추가 \r\n    // origin 추가\r\n    if (!requestOptions['origin']) {\r\n        requestOptions = { ...requestOptions, origin: SERVER_URL };\r\n    }\r\n    // credentials 추가 \r\n    if (!requestOptions['credentials']) {\r\n        requestOptions = { ...requestOptions, credentials: 'include' };\r\n    }\r\n\r\n    fetch(SERVER_URL + url, requestOptions)\r\n        .then(response => {// response Stream. Not completion object\r\n            //console.log(\"requestFetch [Response Stream] \", response); \r\n            return response.json();\r\n        })\r\n        .then((resp) => {\r\n            if (Number(resp.resultCode) === Number(CODE.RCV_ERROR_AUTH)) {\r\n                alert(\"Login Alert\");\r\n                window.location.href = URL.LOGIN;\r\n                return false;\r\n            } else {\r\n                return resp;\r\n            }\r\n        })\r\n        .then((resp) => {\r\n            console.groupCollapsed(\"requestFetch.then()\");\r\n            console.log(\"requestFetch [response] \", resp);\r\n            if (typeof handler === 'function') {\r\n                handler(resp);\r\n            } else {\r\n                console.log('egov fetch handler not assigned!');\r\n            }\r\n            console.groupEnd(\"requestFetch.then()\");\r\n        })\r\n        .catch(error => {\r\n            console.error('There was an error!', error);\r\n            if (error === 'TypeError: Failed to fetch') {\r\n                alert(\"서버와의 연결이 원활하지 않습니다. 서버를 확인하세요.\");\r\n            }\r\n            \r\n            if (typeof errorHandler === 'function') {\r\n                errorHandler(error);\r\n            } else {\r\n                console.error('egov error handler not assigned!');\r\n                alert(\"ERR : \" + error.message);\r\n            }\r\n        })\r\n        .finally(() => {\r\n            console.log(\"requestFetch finally end\");\r\n            console.groupEnd(\"requestFetch\");\r\n        });\r\n}"],"mappings":"AAAA,SAASA,UAAT,QAA2B,UAA3B;AAEA,OAAOC,GAAP,MAAgB,aAAhB;AACA,OAAOC,IAAP,MAAiB,cAAjB;AAEA,OAAO,SAASC,YAAT,CAAsBC,GAAtB,EAA2BC,cAA3B,EAA2CC,OAA3C,EAAoDC,YAApD,EAAkE;EACrEC,OAAO,CAACC,cAAR,CAAuB,cAAvB;EACAD,OAAO,CAACE,GAAR,CAAY,uBAAZ,EAAqCV,UAAU,GAAGI,GAAlD;EACAI,OAAO,CAACE,GAAR,CAAY,iCAAZ,EAA+CL,cAA/C,EAHqE,CAKrE;EACA;;EACA,IAAI,CAACA,cAAc,CAAC,QAAD,CAAnB,EAA+B;IAC3BA,cAAc,GAAG,EAAE,GAAGA,cAAL;MAAqBM,MAAM,EAAEX;IAA7B,CAAjB;EACH,CAToE,CAUrE;;;EACA,IAAI,CAACK,cAAc,CAAC,aAAD,CAAnB,EAAoC;IAChCA,cAAc,GAAG,EAAE,GAAGA,cAAL;MAAqBO,WAAW,EAAE;IAAlC,CAAjB;EACH;;EAEDC,KAAK,CAACb,UAAU,GAAGI,GAAd,EAAmBC,cAAnB,CAAL,CACKS,IADL,CACUC,QAAQ,IAAI;IAAC;IACf;IACA,OAAOA,QAAQ,CAACC,IAAT,EAAP;EACH,CAJL,EAKKF,IALL,CAKWG,IAAD,IAAU;IACZ,IAAIC,MAAM,CAACD,IAAI,CAACE,UAAN,CAAN,KAA4BD,MAAM,CAAChB,IAAI,CAACkB,cAAN,CAAtC,EAA6D;MACzDC,KAAK,CAAC,aAAD,CAAL;MACAC,MAAM,CAACC,QAAP,CAAgBC,IAAhB,GAAuBvB,GAAG,CAACwB,KAA3B;MACA,OAAO,KAAP;IACH,CAJD,MAIO;MACH,OAAOR,IAAP;IACH;EACJ,CAbL,EAcKH,IAdL,CAcWG,IAAD,IAAU;IACZT,OAAO,CAACC,cAAR,CAAuB,qBAAvB;IACAD,OAAO,CAACE,GAAR,CAAY,0BAAZ,EAAwCO,IAAxC;;IACA,IAAI,OAAOX,OAAP,KAAmB,UAAvB,EAAmC;MAC/BA,OAAO,CAACW,IAAD,CAAP;IACH,CAFD,MAEO;MACHT,OAAO,CAACE,GAAR,CAAY,kCAAZ;IACH;;IACDF,OAAO,CAACkB,QAAR,CAAiB,qBAAjB;EACH,CAvBL,EAwBKC,KAxBL,CAwBWC,KAAK,IAAI;IACZpB,OAAO,CAACoB,KAAR,CAAc,qBAAd,EAAqCA,KAArC;;IACA,IAAIA,KAAK,KAAK,4BAAd,EAA4C;MACxCP,KAAK,CAAC,gCAAD,CAAL;IACH;;IAED,IAAI,OAAOd,YAAP,KAAwB,UAA5B,EAAwC;MACpCA,YAAY,CAACqB,KAAD,CAAZ;IACH,CAFD,MAEO;MACHpB,OAAO,CAACoB,KAAR,CAAc,kCAAd;MACAP,KAAK,CAAC,WAAWO,KAAK,CAACC,OAAlB,CAAL;IACH;EACJ,CApCL,EAqCKC,OArCL,CAqCa,MAAM;IACXtB,OAAO,CAACE,GAAR,CAAY,0BAAZ;IACAF,OAAO,CAACkB,QAAR,CAAiB,cAAjB;EACH,CAxCL;AAyCH"},"metadata":{},"sourceType":"module"}